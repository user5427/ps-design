openapi: 3.0.3
info:
  title: "SaaS Platform for Catering & Beauty Businesses API"
  description: "API documentation for a SaaS platform. This API handles order management, service appointments, and business administration."
  version: "1.0.0"
servers:
  - url: "https://api.your-saas.com/v1"
    description: "Production Server"

tags:
  - name: "Authentication"
    description: "Endpoints for user authentication."
  - name: "Order Management"
    description: "API for managing orders in bars and restaurants."
  - name: "Service & Appointment Management"
    description: "API for managing services and appointments in spas and salons."
  - name: "Business Management"
    description: "API for business owners and super admins to manage business settings."

paths:
  /auth/login:
    post:
      tags:
        - "Authentication"
      summary: "User Login"
      description: "Authenticates a business user (employee/owner) and returns a JWT access token."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: "employee@example.com"
                password:
                  type: string
                  format: password
                  example: "secure_password"
      responses:
        '200':
          description: "Authentication successful. Returns access token and user info."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthToken'
        '400':
          description: "Bad Request - Missing or invalid input."
        '401':
          description: "Unauthorized - Invalid credentials."

  /businesses/{businessId}/orders:
    get:
      tags:
        - "Order Management"
      summary: "List Orders for a Business"
      description: "Retrieves a paginated list of orders for a specific business, with optional filtering by status or table."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
          description: "The ID of the business."
        - name: "status"
          in: "query"
          required: false
          schema:
            $ref: '#/components/schemas/OrderStatus'
          description: "Filter orders by their status."
        - name: "limit"
          in: "query"
          required: false
          schema:
            type: integer
            default: 20
          description: "Number of orders to return."
        - name: "offset"
          in: "query"
          required: false
          schema:
            type: integer
            default: 0
          description: "Offset for pagination."
      responses:
        '200':
          description: "A list of orders."
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      tags:
        - "Order Management"
      summary: "Create a New Order"
      description: "Creates a new order with items for a specific table."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
          description: "The ID of the business."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewOrder'
      responses:
        '201':
          description: "Order created successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDetail'
        '400':
          description: "Bad Request - Invalid product ID, stock unavailability, or invalid variations."
        '422':
          description: "Unprocessable Entity - Validation errors in the request body."

  /businesses/{businessId}/orders/{orderId}:
    get:
      tags:
        - "Order Management"
      summary: "Get Order Details"
      description: "Retrieves the full details of a specific order by its ID."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
        - name: "orderId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: "Detailed information about the order."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDetail'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags:
        - "Order Management"
      summary: "Update an Open Order"
      description: "Modifies an existing open order, for example, by adding or removing items."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
        - name: "orderId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewOrder'
      responses:
        '200':
          description: "Order updated successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDetail'
        '403':
          description: "Forbidden - Cannot modify an order that is already paid or cancelled."
        '404':
          $ref: '#/components/responses/NotFound'

  /businesses/{businessId}/orders/{orderId}/payments:
    post:
      tags:
        - "Order Management"
      summary: "Process a Payment for an Order"
      description: "Accepts a payment for an order. Supports split checks by allowing multiple payment calls."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
        - name: "orderId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentRequest'
      responses:
        '200':
          description: "Payment processed successfully. Returns final receipt if fully paid."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Receipt'
        '400':
          description: "Bad Request - Payment amount exceeds amount due."

  /businesses/{businessId}/appointments:
    get:
      tags:
        - "Service & Appointment Management"
      summary: "List Appointments"
      description: "Retrieves a list of appointments for a specific business."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
        - name: "date"
          in: "query"
          schema:
            type: string
            format: date
          description: "Filter appointments by date (e.g., 2025-11-15)."
        - name: "employeeId"
          in: "query"
          schema:
            type: string
            format: uuid
          description: "Filter appointments by employee."
      responses:
        '200':
          description: "A list of appointments."
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Appointment'
    post:
      tags:
        - "Service & Appointment Management"
      summary: "Create an Appointment"
      description: "Books a new service appointment for a customer."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewAppointment'
      responses:
        '201':
          description: "Appointment created successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Appointment'
        '409':
          description: "Conflict - The requested time slot or employee is unavailable."

  /businesses/{businessId}/appointments/{appointmentId}:
    put:
      tags:
        - "Service & Appointment Management"
      summary: "Modify an Appointment"
      description: "Updates the details of an existing appointment, such as time, service, or assigned employee."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
        - name: "appointmentId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAppointment'
      responses:
        '200':
          description: "Appointment updated successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Appointment'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: "Conflict - The requested new time slot or employee is unavailable."
    delete:
      tags:
        - "Service & Appointment Management"
      summary: "Cancel an Appointment"
      description: "Cancels a scheduled appointment."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
        - name: "appointmentId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: "Appointment cancelled successfully. No content returned."
        '404':
          $ref: '#/components/responses/NotFound'

  /businesses/{businessId}/services:
    get:
      tags:
        - "Service & Appointment Management"
      summary: "List Business Services"
      description: "Retrieves a list of all services offered by the business."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: "A list of services."
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Service'

  /businesses/{businessId}/users:
    get:
      tags:
        - "Business Management"
      summary: "List Users"
      description: "Retrieves a list of all users (employees, owners) for a specific business. Requires Business Owner or Super Admin privileges."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: "A list of users."
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      tags:
        - "Business Management"
      summary: "Create a User"
      description: "Creates a new user (employee) for the business. Requires Business Owner or Super Admin privileges."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewUser'
      responses:
        '201':
          description: "User created successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: "Conflict - A user with this email already exists."

  /businesses/{businessId}/products:
    get:
      tags:
        - "Business Management"
      summary: "List Products"
      description: "Retrieves a list of all products/menu items for a business."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: "A list of products."
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
    post:
      tags:
        - "Business Management"
      summary: "Create a Product"
      description: "Creates a new product or menu item for the business. Requires Business Owner or Super Admin privileges."
      parameters:
        - name: "businessId"
          in: "path"
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewProduct'
      responses:
        '201':
          description: "Product created successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '403':
          $ref: '#/components/responses/Forbidden'

  /businesses:
    get:
      tags:
        - "Business Management"
      summary: "List All Businesses (Super Admin)"
      description: "Retrieves a list of all businesses in the system. Requires Super Admin privileges."
      responses:
        '200':
          description: "A list of all businesses."
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Business'
        '403':
          $ref: '#/components/responses/Forbidden'

components:
  schemas:
    # --- ENUMERATIONS ---
    OrderStatus:
      type: string
      enum: [open, paid, cancelled, refunded]
      description: "The status of an order."
    PaymentMethod:
      type: string
      enum: [Cash, CreditCard, GiftCard]
      description: "The method of payment."
    UserRole:
      type: string
      enum: [Employee, BusinessOwner, SuperAdmin]
      description: "The role of a user within the system."
    AppointmentStatus:
      type: string
      enum: [booked, completed, cancelled]
      description: "The status of an appointment."

    # --- SHARED SCHEMAS ---
    Money:
      type: object
      description: "An object representing a monetary value."
      required:
        - amount
        - currency
      properties:
        amount:
          type: decimal
          description: "The monetary amount as a decimal to maintain maximum precision."
          example: 19.93
        currency:
          type: string
          description: "The three-letter ISO 4217 currency code."
          example: "USD"

    # --- AUTHENTICATION SCHEMAS ---
    AuthToken:
      type: object
      properties:
        accessToken:
          type: string
        tokenType:
          type: string
          example: "Bearer"
        expiresIn:
          type: integer
          example: 3600
        user:
          type: object
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
            role:
              $ref: '#/components/schemas/UserRole'

    # --- ORDER SCHEMAS ---
    Order:
      type: object
      properties:
        orderId:
          type: string
          format: uuid
        tableId:
          type: integer
        status:
          $ref: '#/components/schemas/OrderStatus'
        totalAmount:
          $ref: '#/components/schemas/Money'
        createdAt:
          type: string
          format: date-time

    OrderDetail:
      allOf:
        - $ref: '#/components/schemas/Order'
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/OrderItem'
            payments:
              type: array
              items:
                $ref: '#/components/schemas/Payment'
            discountsApplied:
              type: array
              items:
                type: object 
                properties:
                  name:
                    type: string
                  amount:
                    $ref: '#/components/schemas/Money'

    NewOrder:
      type: object
      required:
        - tableId
        - items
      properties:
        tableId:
          type: integer
        items:
          type: array
          items:
            type: object
            required:
              - productId
              - quantity
            properties:
              productId:
                type: string
                format: uuid
              quantity:
                type: integer
              variations:
                type: array
                items:
                  type: string
                  format: uuid
                description: "List of IDs for product variations (e.g., milk type)."

    OrderItem:
      type: object
      properties:
        productId:
          type: string
          format: uuid
        name:
          type: string
          description: "The name of the item at the time of order. Could be a localization key."
        quantity:
          type: integer
        price:
          $ref: '#/components/schemas/Money'

    Payment:
      type: object
      properties:
        paymentId:
          type: string
          format: uuid
        amount:
          $ref: '#/components/schemas/Money'
        paymentMethod:
          $ref: '#/components/schemas/PaymentMethod'
        paymentTimestamp:
          type: string
          format: date-time
          
    PaymentRequest:
      type: object
      required:
        - amount
        - paymentMethod
      properties:
        amount:
          $ref: '#/components/schemas/Money'
        paymentMethod:
          $ref: '#/components/schemas/PaymentMethod'
        tip:
          $ref: '#/components/schemas/Money'
        stripePaymentIntentId:
          type: string
          description: "Required only when paymentMethod is CreditCard."
          
    Receipt:
      type: object
      properties:
        receiptId:
          type: string
          format: uuid
        orderId:
          type: string
          format: uuid
        totalPaid:
          $ref: '#/components/schemas/Money'
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        taxes:
          $ref: '#/components/schemas/Money'
        discounts:
          $ref: '#/components/schemas/Money'
        tip:
          $ref: '#/components/schemas/Money'
        finalTotal:
          $ref: '#/components/schemas/Money'

    # --- APPOINTMENT & SERVICE SCHEMAS ---
    Appointment:
      type: object
      properties:
        appointmentId:
          type: string
          format: uuid
        customerName:
          type: string
        serviceName:
          type: string
        employeeName:
          type: string
        appointmentTime:
          type: string
          format: date-time
        status:
          $ref: '#/components/schemas/AppointmentStatus'

    NewAppointment:
      type: object
      required:
        - serviceId
        - appointmentTime
        - customer
      properties:
        serviceId:
          type: string
          format: uuid
        employeeId:
          type: string
          format: uuid
          description: "Optional, if customer requests a specific employee."
        appointmentTime:
          type: string
          format: date-time
        customer:
          type: object
          properties:
            name:
              type: string
            phone:
              type: string
            email:
              type: string
              format: email
              
    UpdateAppointment:
      type: object
      properties:
        serviceId:
          type: string
          format: uuid
        employeeId:
          type: string
          format: uuid
        appointmentTime:
          type: string
          format: date-time
        status:
          $ref: '#/components/schemas/AppointmentStatus'

    Service:
      type: object
      properties:
        serviceId:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        duration:
          type: integer
          description: "Duration of the service in minutes."
        price:
          $ref: '#/components/schemas/Money'

    # --- BUSINESS & USER MANAGEMENT SCHEMAS ---
    Business:
      type: object
      properties:
        businessId:
          type: string
          format: uuid
        name:
          type: string
        address:
          type: string
        phone:
          type: string
        ownerUserId:
          type: string
          format: uuid

    User:
      type: object
      properties:
        userId:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email
        role:
          $ref: '#/components/schemas/UserRole'
        isActive:
          type: boolean

    NewUser:
      type: object
      required:
        - name
        - email
        - password
        - role
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          format: password
        role:
          type: string
          enum: [Employee, BusinessOwner]

    Product:
      type: object
      properties:
        productId:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        price:
          $ref: '#/components/schemas/Money'
        category:
          type: string
        taxId:
          type: string
          format: uuid
        variations:
          type: array
          items:
            type: object
            properties:
              variationId:
                type: string
                format: uuid
              name:
                type: string
              additionalCost:
                $ref: '#/components/schemas/Money'

    NewProduct:
      type: object
      required:
        - name
        - price
      properties:
        name:
          type: string
        description:
          type: string
        price:
          $ref: '#/components/schemas/Money'
        category:
          type: string
        taxId:
          type: string
          format: uuid

    # --- GENERAL ERROR SCHEMA ---
    Error:
      type: object
      properties:
        code:
          type: string
        message:
          type: string

  responses:
    Unauthorized:
      description: "Unauthorized - Authentication token is missing or invalid."
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Forbidden:
      description: "Forbidden - The authenticated user does not have permission to perform this action."
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: "Not Found - The requested resource could not be found."
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - bearerAuth: []